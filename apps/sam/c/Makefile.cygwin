#
# This Makefile is compatible with GNU Make and should work on Cygwin
#

#
# Your operating environment
#

OS = CYGWIN

#
# Directories
#

INCDIR = inc
LIBDIR = lib
OBJDIR = obj
SRCDIR = src

#
# Programs
#

AR = ar
CC = gcc

#
# Flags
#

CFLAGS = -g -march=i486 -O2 -pipe -std=c99 -Wall
CFLAGS += -DOS=$(OS)
CFLAGS += -I$(INCDIR)

#
# Object files
#

OBJS =	$(OBJDIR)/sam.o \
		$(OBJDIR)/snprintf.o \
		$(OBJDIR)/strl.o

#
# Build rules
#

all: depend libsam

depend:
	$(CC) $(CFLAGS) -MM $(SRCDIR)/*.c > .depend

$(OBJDIR)/%.o: $(SRCDIR)/%.c
	$(CC) $(CFLAGS) -o $@ -c $<

libsam: $(OBJS)
	$(AR) rcs $(LIBDIR)/libsam.a $(OBJS)

#
# Cleanup rules
#

clean:
	-rm -f $(LIBDIR)/libsam.a $(OBJDIR)/* .depend

tidy: clean
